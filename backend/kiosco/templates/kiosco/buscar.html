<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <title>{{ title }}</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    {% load static %}
    <link href="{% static 'kiosco/css/buscar.css' %}" rel="stylesheet"/>
</head>
<body>

<div aria-labelledby="main-title" class="container" role="main">
    {% if mostrar_inicio %}
    <a href="{{ home_url }}" class="home-link">{{ home_label }}</a>
    {% endif %}

    <h1 id="main-title">{{ header }}</h1>

    <form id="buscar-form" method="POST">
        {% csrf_token %}
        <div class="form-group">
            <!-- ID -->
            {% if id_label %}
            <label for="id">{{ id_label }}</label>
            <div class="input-group {% if id_error %}error{% endif %}">
                <input
                        aria-describedby="{% if id_error %}id-error{% endif %}"
                        aria-invalid="{% if id_error %}true{% else %}false{% endif %}"
                        class="{% if id_error %}error{% endif %}"
                        id="id"
                        maxlength="{{ id_max_length|default:50 }}"
                        name="id"
                        pattern="{{ id_pattern|default:'' }}"
                        placeholder="{{ id_placeholder|default:'' }}"
                        {% if id_required %}required{% endif %}
                        type="text"
                        value="{{ id|default:'' }}"
                />
            </div>
            {% endif %}
            <!-- Fecha -->
            {% if date_label %}
            <label class="fecha-label" for="fecha">{{ date_label }}</label>
            {% if date_sublabel %}
            <p class="form-sublabel">{{ date_sublabel }}</p>
            {% endif %}
            <div class="input-group {% if date_error %}error{% endif %}">
                <input
                        aria-describedby="{% if date_error %}fecha-error{% endif %}"
                        aria-invalid="{% if date_error %}true{% else %}false{% endif %}"
                        class="{% if date_error %}error{% endif %}"
                        id="fecha"
                        name="fecha"
                        {% if date_required %}required{% endif %}
                        type="date"
                        value="{{ fecha_inicial|date:'Y-m-d' }}"
                />
            </div>
            {% endif %}
        </div>

        <button aria-label="{{ button_label }}" type="submit">
            {{ button_label }}
        </button>
    </form>

    <!-- Respuesta AJAX (fallback) -->
    <div id="respuesta-ajax">
        {% if not persona and id_proporcionado %}
        {% include 'kiosco/partials/mensaje_error.html' %}
        {% endif %}
    </div>
</div>

<!-- Mensaje de 'Procesando...' -->
<div id="processing-message" aria-hidden="true">
    <div class="spinner"></div>
    <div>{{ processing_message|default:"Procesando..." }}</div>
</div>

<!-- Modal de persona si hay resultados -->
{% if persona and id %}
{% include 'kiosco/partials/modal_buscar.html' %}
{% endif %}

<!-- Scripts -->
<script>
    window.FormConfig = {
        idRequired: {{ id_required|yesno:"true,false" }},
        dateRequired: {{ date_required|yesno:"true,false" }},
        autoBorrado: {{ auto_borrado|yesno:"true,false" }}
    };
</script>
<script defer src="{% static 'kiosco/js/error_form_handler.js' %}"></script>
<script defer src="{% static 'kiosco/js/buscar.js' %}"></script>
<script defer src="{% static 'kiosco/js/enviar_pdf_whatsapp.js' %}"></script>
</body>
</html>
