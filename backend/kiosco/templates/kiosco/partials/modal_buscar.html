{% load custom_filters %}

<div
        aria-labelledby="modal.title"
        aria-modal="true"
        class="modal visible"
        id="modal"
        role="dialog"
        tabindex="-1"
>
    <div class="modal-content">
        <button aria-label="Cerrar modal" class="close-btn" onclick="cerrarModal()">×</button>

        {% if modal.title %}
        <h2 id="modal-title">{{ modal.title }}</h2>
        {% endif %}

        {% if sujeto %}

        {% if modal.data_title %}
        <h3 id="data-title">{{ modal.data_title }}</h3>
        {% endif %}

        {% for titulo, valor in sujeto.items %}
        <div class="dato">
            <span>{{ titulo }}:</span> {{ valor }}
        </div>
        {% endfor %}

        {% endif %}

        <div class="dato">

            {% if modal.table_title %}
            <h3>{{ modal.table_title }}</h3>
            {% endif %}

            <div class="tabla-scrollable">
                <table>
                    <thead>
                    <tr>
                        {% for columna in tabla_columnas %}
                        <th>{{ columna }}</th>
                        {% endfor %}
                    </tr>
                    </thead>
                    <tbody>
                    {% for fila in tabla %}
                    <tr>
                        {% for dato in fila %}
                        <td data-label="{{ tabla_columnas|index:forloop.counter0 }}">{{ dato|default_if_none:"" }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        {% if modal.preview.show or modal.send_email.show %}
        <div class="botones-agrupados">
            {% if modal.preview.show %}
            <button
                    class="btn btn-outline-primary"
                    onclick="abrirVistaPrevia()"
                    type="button"
            >
                {{ modal.preview.button_label }}
            </button>
            {% endif %}
            {% if modal.send_email.show %}
            <button
                    class="btn btn-outline-secondary"
                    onclick="mostrarFormularioEmail()"
                    type="button"
            >
                {{ modal.send_email.button_label }}
            </button>
            {% endif %}
        </div>
        {% endif %}

        <form
                action="{% url 'send_email_pdf' %}"
                id="send-email-pdf-form"
                method="POST"
                style="display: none; margin-top: 1em;"
        >
            {% csrf_token %}
            <div class="input-button-row">
                <label for="email">{{ modal.send_email.email_label }}</label>
                <input
                        id="email"
                        name="email"
                        placeholder="{{ modal.send_email.placeholder }}"
                        required
                        title="{{ modal.send_email.pattern_text }}"
                        type="email"
                />
                <button class="btn btn-primary" type="submit">
                    {{ modal.send_email.send_label }}
                </button>
            </div>
        </form>

        <form action="{% url 'send_whatsapp_pdf' %}" id="form-send-whatsapp-pdf" method="POST">
            {% csrf_token %}
            <div class="input-button-row">
                <label class="btn-whatsapp-label" for="numero-whatsapp">{{ modal.send_whatsapp.number_label }}</label>

                <input class="btn-whatsapp-input"
                       id="numero-whatsapp"
                       name="numero"
                       pattern="{{ modal.send_whatsapp.pattern }}"
                       placeholder="{{ modal.send_whatsapp.placeholder }}"
                       required
                       title="{{ modal.send_whatsapp.pattern_text }}"
                       type="text"/>

                <button class="btn-whatsapp" type="submit">{{ modal.send_whatsapp.send_label }}</button>
            </div>
        </form>

        <!-- Contenedor donde se cargará el mensaje de error por AJAX -->
        <div class="mensaje-transitorio" id="mensaje-envio" style="display: none;"></div>
    </div>
</div>
